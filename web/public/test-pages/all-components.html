<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Components - Unraid Component Test</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f3f4f6;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.dark {
      background: #111827;
      color: #f9fafb;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .component-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .component-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    body.dark .component-card {
      background: #1f2937;
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
    .component-card h3 {
      margin: 0 0 10px 0;
      color: #1f2937;
      font-size: 16px;
      font-weight: 600;
      transition: color 0.3s ease;
    }
    body.dark .component-card h3 {
      color: #f9fafb;
    }
    .component-card .selector {
      font-family: monospace;
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 15px;
      background: #f3f4f6;
      padding: 4px 8px;
      border-radius: 4px;
      display: inline-block;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.dark .component-card .selector {
      background: #374151;
      color: #9ca3af;
    }
    .component-mount {
      min-height: 50px;
      border: 1px dashed #e5e7eb;
      border-radius: 4px;
      padding: 10px;
      position: relative;
      transition: border-color 0.3s ease;
    }
    body.dark .component-mount {
      border-color: #374151;
    }
    .status {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #10b981;
    }
    .category-header {
      background: #1f2937;
      color: white;
      padding: 10px 15px;
      border-radius: 4px;
      margin: 30px 0 15px 0;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    body.dark .category-header {
      background: #374151;
    }
    .dark-mode-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: #1f2937;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }
    body.dark .dark-mode-toggle {
      background: #f3f4f6;
      color: #1f2937;
    }
    .dark-mode-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <button class="dark-mode-toggle" id="darkModeToggle">üåô Dark Mode</button>
  <div class="container">
    <!-- Authentication & User -->
    <div class="category-header">üë§ Authentication & User</div>
    <div class="component-grid">
      <div class="component-card">
        <h3>Authentication</h3>
        <span class="selector">&lt;unraid-auth&gt;</span>
        <div class="component-mount">
          <unraid-auth></unraid-auth>
        </div>
      </div>

      <div class="component-card">
        <h3>User Profile</h3>
        <span class="selector">&lt;unraid-user-profile&gt;</span>
        <div class="component-mount">
          <unraid-user-profile></unraid-user-profile>
        </div>
      </div>

      <div class="component-card">
        <h3>SSO Button</h3>
        <span class="selector">&lt;unraid-sso-button&gt;</span>
        <div class="component-mount">
          <unraid-sso-button></unraid-sso-button>
        </div>
      </div>

      <div class="component-card">
        <h3>Registration</h3>
        <span class="selector">&lt;unraid-registration&gt;</span>
        <div class="component-mount">
          <unraid-registration></unraid-registration>
        </div>
      </div>
    </div>

    <!-- System & Settings -->
    <div class="category-header">‚öôÔ∏è System & Settings</div>
    <div class="component-grid">
      <div class="component-card">
        <h3>Connect Settings</h3>
        <span class="selector">&lt;unraid-connect-settings&gt;</span>
        <div class="component-mount">
          <unraid-connect-settings></unraid-connect-settings>
        </div>
      </div>

      <div class="component-card">
        <h3>Theme Switcher</h3>
        <span class="selector">&lt;unraid-theme-switcher&gt;</span>
        <div class="component-mount">
          <unraid-theme-switcher current="white"></unraid-theme-switcher>
        </div>
      </div>

      <div class="component-card">
        <h3>Header OS Version</h3>
        <span class="selector">&lt;unraid-header-os-version&gt;</span>
        <div class="component-mount">
          <unraid-header-os-version></unraid-header-os-version>
        </div>
      </div>

      <div class="component-card">
        <h3>WAN IP Check</h3>
        <span class="selector">&lt;unraid-wan-ip-check&gt;</span>
        <div class="component-mount">
          <unraid-wan-ip-check php-wan-ip="192.168.1.1"></unraid-wan-ip-check>
        </div>
      </div>
    </div>

    <!-- OS Management -->
    <div class="category-header">üíø OS Management</div>
    <div class="component-grid">
      <div class="component-card">
        <h3>Update OS</h3>
        <span class="selector">&lt;unraid-update-os&gt;</span>
        <div class="component-mount">
          <unraid-update-os></unraid-update-os>
        </div>
      </div>

      <div class="component-card">
        <h3>Downgrade OS</h3>
        <span class="selector">&lt;unraid-downgrade-os&gt;</span>
        <div class="component-mount">
          <unraid-downgrade-os></unraid-downgrade-os>
        </div>
      </div>
    </div>

    <!-- API & Developer -->
    <div class="category-header">üîß API & Developer</div>
    <div class="component-grid">
      <div class="component-card">
        <h3>API Key Manager</h3>
        <span class="selector">&lt;unraid-api-key-manager&gt;</span>
        <div class="component-mount">
          <unraid-api-key-manager></unraid-api-key-manager>
        </div>
      </div>

      <div class="component-card">
        <h3>API Key Authorize</h3>
        <span class="selector">&lt;unraid-api-key-authorize&gt;</span>
        <div class="component-mount">
          <unraid-api-key-authorize></unraid-api-key-authorize>
        </div>
      </div>

      <div class="component-card">
        <h3>Download API Logs</h3>
        <span class="selector">&lt;unraid-download-api-logs&gt;</span>
        <div class="component-mount">
          <unraid-download-api-logs></unraid-download-api-logs>
        </div>
      </div>

      <div class="component-card">
        <h3>Log Viewer</h3>
        <span class="selector">&lt;unraid-log-viewer&gt;</span>
        <div class="component-mount">
          <unraid-log-viewer></unraid-log-viewer>
        </div>
      </div>
    </div>

    <!-- UI Components -->
    <div class="category-header">üé® UI Components</div>
    <div class="component-grid">
      <div class="component-card">
        <h3>Modals</h3>
        <span class="selector">&lt;unraid-modals&gt;</span>
        <div class="component-mount">
          <unraid-modals></unraid-modals>
        </div>
      </div>

      <div class="component-card">
        <h3>Welcome Modal</h3>
        <span class="selector">&lt;unraid-welcome-modal&gt;</span>
        <div class="component-mount">
          <unraid-welcome-modal></unraid-welcome-modal>
        </div>
      </div>

      <div class="component-card">
        <h3>Dev Modal Test</h3>
        <span class="selector">&lt;unraid-dev-modal-test&gt;</span>
        <div class="component-mount">
          <unraid-dev-modal-test></unraid-dev-modal-test>
        </div>
      </div>

      <div class="component-card">
        <h3>Activation Modal Tests</h3>
        <span class="selector">Interactive Tests</span>
        <div class="component-mount">
          <button id="test-activation-modal" class="test-btn" style="margin: 5px;">Show Activation Modal</button>
          <button id="test-activation-with-code" class="test-btn" style="margin: 5px;">Show w/ Activation Code</button>
        </div>
      </div>

      <div class="component-card">
        <h3>Toaster</h3>
        <span class="selector">&lt;unraid-toaster&gt;</span>
        <div class="component-mount">
          <unraid-toaster></unraid-toaster>
        </div>
      </div>
    </div>

    <!-- Test Controls -->
    <div class="category-header">üéÆ Test Controls</div>
    <div class="test-controls-container">
      <h3>jQuery Interaction Tests</h3>
      <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
        <button id="test-notification" class="test-btn">Trigger Notification</button>
        <button id="test-modal" class="test-btn">Open Test Modal</button>
        <button id="test-theme" class="test-btn">Toggle Theme</button>
        <button id="test-update-profile" class="test-btn">Update Profile Data</button>
        <button id="test-settings" class="test-btn">Update Settings</button>
      </div>
      
      <div style="margin-top: 20px;">
        <h4>Console Output</h4>
        <div id="test-output">
          > Ready for testing...
        </div>
      </div>
    </div>
  </div>

  <style>
    .test-btn {
      padding: 8px 16px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .test-btn:hover {
      background: #2563eb;
    }
    .test-controls-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 15px;
      transition: background-color 0.3s ease;
    }
    body.dark .test-controls-container {
      background: #1f2937;
    }
    .test-controls-container h3,
    .test-controls-container h4 {
      transition: color 0.3s ease;
    }
    body.dark .test-controls-container h3,
    body.dark .test-controls-container h4 {
      color: #f9fafb;
    }
    #test-output {
      background: #1f2937;
      color: #10b981;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      min-height: 100px;
      max-height: 200px;
      overflow-y: auto;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.dark #test-output {
      background: #111827;
      color: #34d399;
    }
  </style>

  <!-- Load the manifest and inject resources -->
  <script src="/test-pages/load-manifest.js"></script>
  <script src="/test-pages/test-server-state.js"></script>
  <script src="/test-pages/shared-header.js"></script>

  <!-- Test interactions -->
  <script>
    $(document).ready(function() {
      const output = $('#test-output');
      
      function log(message) {
        // Use shared header's testLog if available, otherwise local log
        if (window.testLog) {
          window.testLog(message);
        }
        if (output.length) {
          const timestamp = new Date().toLocaleTimeString();
          output.append('\n> [' + timestamp + '] ' + message);
          output.scrollTop(output[0].scrollHeight);
        }
      }
      
      // Dark mode toggle - syncs with theme store
      // The theme store is exposed globally by mount-engine.ts and controls:
      // - CSS variables for colors
      // - .dark class on html, body, and all .unapi elements
      // - Theme variants (theme-white, theme-gray, theme-black)
      // All Vue components automatically inherit the theme via this system
      const darkModeToggle = $('#darkModeToggle');
      
      function updateDarkModeButton() {
        if (window.themeStore) {
          const isDark = window.themeStore.darkMode;
          darkModeToggle.text(isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode');
        }
      }
      
      const waitForThemeStore = setInterval(function() {
        if (window.themeStore) {
          clearInterval(waitForThemeStore);
          updateDarkModeButton();
          log('Theme store connected');
        }
      }, 100);
      
      darkModeToggle.on('click', function() {
        if (!window.themeStore) {
          log('ERROR: Theme store not available');
          return;
        }
        
        const currentTheme = window.themeStore.theme.name;
        const isDarkTheme = currentTheme === 'gray' || currentTheme === 'black';
        const newTheme = isDarkTheme ? 'white' : 'gray';
        
        window.themeStore.theme.name = newTheme;
        window.themeStore.setCssVars();
        
        updateDarkModeButton();
        log('Theme changed to: ' + newTheme);
      });
      
      // Test notification
      $('#test-notification').on('click', function() {
        log('Triggering notification...');
        const event = new CustomEvent('unraid:notification', {
          detail: { 
            title: 'Test Notification', 
            message: 'This is a test from jQuery!', 
            type: 'success' 
          }
        });
        document.dispatchEvent(event);
      });
      
      // Test modal
      $('#test-modal').on('click', function() {
        log('Opening test modal...');
        // This would trigger the modal system
        window.dispatchEvent(new CustomEvent('unraid:open-modal', {
          detail: { modalId: 'test-modal' }
        }));
      });
      
      // Test theme toggle
      $('#test-theme').on('click', function() {
        if (!window.themeStore) {
          log('ERROR: Theme store not available');
          return;
        }
        
        log('Toggling theme...');
        const currentTheme = window.themeStore.theme.name;
        const isDarkTheme = currentTheme === 'gray' || currentTheme === 'black';
        const newTheme = isDarkTheme ? 'white' : 'gray';
        
        window.themeStore.theme.name = newTheme;
        window.themeStore.setCssVars();
        updateDarkModeButton();
        
        log('Theme changed to: ' + newTheme);
      });
      
      // Test profile update
      $('#test-update-profile').on('click', function() {
        log('Updating profile data...');
        const profileData = {
          name: 'Test User ' + Math.floor(Math.random() * 100),
          email: 'test' + Math.floor(Math.random() * 100) + '@example.com',
          username: 'testuser'
        };
        $('unraid-user-profile').attr('server', JSON.stringify(profileData));
        log('Profile updated: ' + JSON.stringify(profileData));
      });
      
      // Test settings update
      $('#test-settings').on('click', function() {
        log('Updating connect settings...');
        const settings = {
          enabled: Math.random() > 0.5,
          url: 'https://connect.unraid.net',
          lastSync: new Date().toISOString()
        };
        $('unraid-connect-settings').attr('initial-settings', JSON.stringify(settings));
        log('Settings updated: ' + JSON.stringify(settings));
      });
      
      // Test activation modal (no code)
      $('#test-activation-modal').on('click', function() {
        console.log('Button clicked: test-activation-modal');
        log('Opening activation modal (timezone only)...');
        log('globalPinia available: ' + !!window.globalPinia);
        if (window.globalPinia) {
          log('Pinia stores: ' + Array.from(window.globalPinia._s.keys()).join(', '));
          const activationModalStore = window.globalPinia._s.get('activationCodeModal');
          if (activationModalStore) {
            activationModalStore.setIsHidden(false);
            log('Activation modal opened (no activation code)');
          } else {
            log('ERROR: Activation modal store not found');
          }
        } else {
          log('ERROR: globalPinia not available');
        }
      });
      
      // Test activation modal with fake code
      $('#test-activation-with-code').on('click', function() {
        console.log('Button clicked: test-activation-with-code');
        log('Opening activation modal with fake activation code...');
        log('globalPinia: ' + !!window.globalPinia + ', apolloClient: ' + !!window.apolloClient);
        if (window.globalPinia && window.apolloClient) {
          const activationModalStore = window.globalPinia._s.get('activationCodeModal');
          const apolloClient = window.apolloClient;
          
          if (activationModalStore) {
            try {
              log('Modifying Apollo cache...');
              // Directly modify the Apollo cache ROOT_QUERY
              apolloClient.cache.modify({
                id: apolloClient.cache.identify({ __typename: 'Query' }),
                fields: {
                  customization(existingCustomization) {
                    const existing = existingCustomization || { __typename: 'Customization' };
                    return {
                      ...existing,
                      activationCode: {
                        __typename: 'ActivationCode',
                        code: 'FAKE-TEST-CODE-12345',
                        partnerName: 'Test Partner',
                        serverName: null,
                        sysModel: null,
                        comment: null,
                        header: null,
                        headermetacolor: null,
                        background: null,
                        showBannerGradient: null,
                        theme: null,
                      },
                    };
                  },
                },
              });
              
              log('Cache modified, opening modal...');
              activationModalStore.setIsHidden(false);
              log('Activation modal opened WITH activation code');
            } catch (error) {
              log('ERROR: ' + error.message);
              console.error('Full error:', error);
            }
          } else {
            log('ERROR: Activation modal store not found');
          }
        } else {
          log('ERROR: globalPinia or apolloClient not available');
        }
      });
      
      log('Activation modal test buttons registered');
      
      // Listen for component events
      $(document).on('unraid:theme-changed', function(e, data) {
        log('Theme changed event received: ' + JSON.stringify(data));
      });
      
      $(document).on('unraid:settings-saved', function(e, data) {
        log('Settings saved event received: ' + JSON.stringify(data));
      });
      
      log('Test page initialized - all components loaded');
    });
  </script>
</body>
</html>